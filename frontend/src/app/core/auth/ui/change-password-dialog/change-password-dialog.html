<h2 mat-dialog-title>Changer le mot de passe</h2>

<form class="change-password-dialog__form" [formGroup]="form" (ngSubmit)="submit($event)">
  <div mat-dialog-content>
    <mat-form-field appearance="outline" class="change-password-dialog__field">
      <mat-label>Mot de passe actuel</mat-label>
      <input matInput type="password" formControlName="currentPassword" autocomplete="current-password" />
      @if (form.controls.currentPassword.touched && form.controls.currentPassword.hasError('required')) {
        <mat-error>Le mot de passe actuel est requis.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="change-password-dialog__field">
      <mat-label>Nouveau mot de passe</mat-label>
      <input matInput type="password" formControlName="newPassword" autocomplete="new-password" />
      @if (form.controls.newPassword.touched && form.controls.newPassword.hasError('required')) {
        <mat-error>Le nouveau mot de passe est requis.</mat-error>
      }
      @if (form.controls.newPassword.touched && form.controls.newPassword.hasError('minlength')) {
        <mat-error>Le mot de passe doit contenir au moins 8 caractères.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="change-password-dialog__field">
      <mat-label>Confirmer le nouveau mot de passe</mat-label>
      <input matInput type="password" formControlName="confirmPassword" autocomplete="new-password" />
      @if (form.controls.confirmPassword.touched && form.controls.confirmPassword.hasError('required')) {
        <mat-error>La confirmation est requise.</mat-error>
      }
      @if (form.controls.confirmPassword.touched && form.hasError('passwordMismatch')) {
        <mat-error>Les mots de passe ne correspondent pas.</mat-error>
      }
    </mat-form-field>

    @if (errorMessage) {
      <p class="change-password-dialog__error">{{ errorMessage }}</p>
    }
  </div>

  <div mat-dialog-actions align="end">
    <button mat-button type="button" (click)="close()" [disabled]="loading">Annuler</button>
    <button mat-flat-button color="primary" type="submit" [disabled]="loading || form.invalid">
      {{ loading ? 'Enregistrement...' : 'Mettre à jour' }}
    </button>
  </div>
</form>
