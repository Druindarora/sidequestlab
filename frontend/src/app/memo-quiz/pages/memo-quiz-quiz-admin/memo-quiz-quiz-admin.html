<div class="page mq-quiz-admin">
  <mat-card class="mq-card">
    <mat-card-header>
      <div class="mq-card-header">
        <div class="mq-title">
          <mat-card-title class="mq-page-title">Gérer le quiz</mat-card-title>
          <mat-card-subtitle class="mq-page-subtitle">
            Quiz actuel : {{ quiz.name }}
          </mat-card-subtitle>
        </div>
      </div>
    </mat-card-header>

    <mat-card-content class="mq-card-content">
      <!-- Récap : Inactives / Boîtes / Archivées -->
      <section class="mq-stats">
        <div class="mq-chip-list" aria-label="Récapitulatif des statuts et boîtes">
          <span class="mq-chip mq-chip--neutral">Inactives : {{ inactiveCount }}</span>

          <ng-container *ngFor="let i of [1, 2, 3, 4, 5, 6, 7]">
            <span class="mq-chip mq-chip--neutral">Boîte {{ i }} : {{ boxCount(i) }}</span>
          </ng-container>

          <span class="mq-chip mq-chip--emphasis">Archivées : {{ archivedCount }}</span>
        </div>
      </section>

      <!-- Contrôles : filtre + toggle -->
      <section class="mq-controls">
        <mat-form-field appearance="outline" class="mq-filter">
          <mat-label>Filtrer</mat-label>
          <input matInput (input)="applyFilter($event)" placeholder="Question ou réponse" />
        </mat-form-field>

        <mat-slide-toggle
          class="mq-toggle"
          color="primary"
          aria-label="Afficher uniquement les inactives"
          (change)="toggleView($event.checked ? 'inactive' : 'all')"
        >
          Inactives
        </mat-slide-toggle>
      </section>

      <!-- Table -->
      <section class="mq-table">
        <table mat-table [dataSource]="dataSource" class="mq-material-table" matSort>
          <!-- Question -->
          <ng-container matColumnDef="question">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Question</th>
            <td mat-cell *matCellDef="let element">
              <span class="mq-truncate" [matTooltip]="element.question">
                {{ element.question }}
              </span>
            </td>
          </ng-container>

          <!-- Réponse -->
          <ng-container matColumnDef="answer">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Réponse</th>
            <td mat-cell *matCellDef="let element">
              <span class="mq-truncate" [matTooltip]="element.answer">
                {{ element.answer }}
              </span>
            </td>
          </ng-container>

          <!-- Statut -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Statut</th>
            <td mat-cell *matCellDef="let element">
              <span *ngIf="element.status === 'active'" class="status-pill status-pill--active">
                <mat-icon aria-hidden="true">check_circle</mat-icon>
                <span>Active</span>
              </span>

              <span *ngIf="element.status === 'archived'" class="status-pill status-pill--archived">
                <mat-icon aria-hidden="true">archive</mat-icon>
                <span>Archivée</span>
              </span>

              <span *ngIf="element.status === 'inactive'" class="status-pill status-pill--inactive">
                <mat-icon aria-hidden="true">pause_circle</mat-icon>
                <span>Inactive</span>
              </span>
            </td>
          </ng-container>

          <!-- Boîte -->
          <ng-container matColumnDef="box">
            <th mat-header-cell *matHeaderCellDef>Boîte</th>
            <td mat-cell *matCellDef="let element">
              {{ element.box ?? '—' }}
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let element" class="mq-actions-cell">
              <div class="mq-actions-wrap">
                <button
                  mat-flat-button
                  color="primary"
                  *ngIf="element.status === 'inactive'"
                  (click)="activateCard(element)"
                >
                  Activer
                </button>

                <span *ngIf="element.status === 'active'" class="mq-actions-label">Active</span>
                <span *ngIf="element.status === 'archived'" class="mq-actions-label">Archivée</span>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <mat-paginator
          [pageSizeOptions]="[5, 10, 25]"
          [pageSize]="10"
          showFirstLastButtons
        ></mat-paginator>
      </section>
    </mat-card-content>
  </mat-card>
</div>
